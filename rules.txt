--RULES--

--Players--

There are 2 players:
1. The Red Player
2. The Blue Player

Each player represents a nation. The red and blue nations are at war with each other. Both nation blames the other for the ongoing demon invasion, and will fight to the death despite the current world-ending catastrophe (said demon invasion).

--Gold--

Each player starts the game with 20 gold.

--Turns--

The game is turn based, starting at turn 0, and ending at turn 1000.

-- 4 Phases Per Turn--

Each turn is divided into 3 phases, which happen sequentially.
In the first 2 phases, each player makes decisions.
The result of both players' actions is always applied at once.

--Phase 1: Builder Action--

In this Phase, Each player may choose to do one of the following:
1. Build one tower
2. Destroy one tower
3. Do Nothing

--Tower Build Action--

If a player chooses to build a tower, they must also choose an (X,Y) position to build it at, and a tower to build.

If the Tower Build Action is valid, it is performed: a tower is built at the specified position, and the price of the tower type is subtracted from the gold of the player who built it.

If the Tower Build Action is not valid, it is not performed, and the player does NOT get a second chance to build or destroy this turn.

--Valid Tower Build Action--

A choice of tower position is valid if:
1. It is in the territory of the player who is building it
( There must be a Red Territory tile at that position if the Red Player chose to build there, etc. )
2. There is no entity at that position

A choice of tower is valid if:
1. The player has enough money to buy the tower

--Tower Destroy Action--

If a player chooses to destroy a tower, they must also choose an (X,Y) position to destroy a tower at.

If the Tower Destroy Action is valid it is performed: the tower at (X,Y) is destroyed, and half of its price is refunded.

If the Tower Destroy Action is not valid, it is not performed, and the player does NOT get a second chance to build or destroy this turn.

--Valid Tower Destroy Action--

A choice of tower position is valid if and only if:
1. It is in the territory of the player who is destroying a tower there
( There must be a Red Territory tile at that position if the Red Player chose to build there, etc. )
2. There is a tower there.

--Phase 2: Buy Mercenaries--

Each player has the choice to buy a Mercenary.
Mercenaries cost 20 gold.
The player who buys a mercenary must select a direction ( NSEW )
If the mercenary purchase is valid, a Mercenary will be queued in the selected direction, and 20 gold will be subtracted from the player's gold.

--Valid Mercenary Purchase--

1. There is a path tile in the selected direction
2. The player has 20 or more gold
3. There is not already a queued mercenary in that direction

--Phase 3: World Update--

--Phase 3 Part 1: Mercenary Turn--

For fairness' sake, all Mercenaries move at the same time.

Mercenaries follow the shortest sequence of adjacent path tiles to the enemy's Player Base.

Mercernaries can walk over demon spawners.

A Mercenary is Moving if it is not Fighting or Waiting.

A Mercenary is Waiting if:
1. An allied Mercenary directly in front of it is fighting
2. An allied Mercenary directly in front of it is waiting

A Mercenary is Fighting if there is a rival Mercenary or Demon blocking its path.
A Mercenary is Fighting if it is two spaces away from the enemy's Player Base, leaving room for the enemy to spawn a Mercenary adjacent to their base.

When two rival Mercenaries both want to move into the same space, they can't move ( they are Fighting ).

1. Figure out which Mercenaries are Fighting/Moving/Waiting.

2. Move all Moving Mercenaries.

3. For each Fighting Mercenary, subtract 7 HP from its opponent ( Demon, enemy Mercenary, or enemy Player Base )

Zero or less HP means that a Mercenary/Demon has suffered Mortal Wounds. However, Mercenaries are fanatical, so this will not stop them from hitting their opponent this turn.

4. Remove all Demons with Mortal Wounds from the game.

5. Remove all Mercenaries with Mortal Wounds from the game.

6. Check for Win/Lose condition ( see Win/Lose Condition section )

--Phase 3 Part 2: Demon Turn--

Demons generally follow the same rules for Fighting/Waiting/Moving as Mercenaries.

1. Figure out which Demons are Fighting/Moving/Waiting.

2. Move all Moving Demons.

3. For each Fighting Demon, subtract 7 HP from its opponent ( Mercenary, or Player Base )

4. Remove all Mercenaries with Mortal Wounds from the game.

5. Check for Win/Lose condition ( see Win/Lose Condition section )

--Phase 3 Part 3: Mercenary Spawn--

For each direction a Mercenary is queued in, spawn a Mercenary there if there is no allied Mercenary blocking the path.

--Phase 3 Part 4: Demon Spawn--

If the current turn is a multiple of 10, set queued demons to 1.

If the Demon Spawner has a queued demon, and there is nothing in the way, spawn a Demon in the same position as the spawner, and set queued demons to 0.

--Phase 3 Part 5: Tower Turn--

For each tower, subtract 1 turn from its current cooldown.

If the tower's current cooldown is zero, set its current cooldown back to its max cooldown, and then perform the tower's Action.

As before, determine what Demons/Mercenaries have mortal wounds, and remove them if they do have mortal wounds.

--Tower Action--

Houses add 12 gold to their player's Gold.

The Crossbow and Cannon towers attack the closest Demon/Enemy Mercenary to their Base that's in their range.

The Crossbow does 1 damage
The Cannon does 3 damage

The Minigun does 2 damage to all enemies in its range

--Tiles--

Each tile has an (X,Y) position in 2d.
No two tiles have the same position.

There are 3 types of tiles:
1. Blue Territory
2. Red Territory
3. Path

Technically, there is a 4th SECRET type of tile: THE ABYSS
THE ABYSS exists at positions where there is no other tile

--Entities--

Each entity has:
1. Some amount of health
2. A position in 2d

--Entity Type: Player Base--

The Player Base is a type of entity.
There exists one and only one player base for each player.
Each Player Base always starts the game with 100 health.
Each Player Base has a Mercenary queued in up to 4 cardinal directions.

--Entity Type: Mercenary--

The Mercenary is a type of entity.
Each Mercenary has Allegiance to one and only one Player.
Each Mercenary always starts the game with 20 health.
Mercenaries can only be on path tiles.

--Entity Type: Demon Spawner--

The Demon Spawner is a portal to hell. It has no allegiance, other than to despair and misery for the red and blue nations.

The Demon Spawner is a type of entity.
Each Demon Spawner has one Target, which is one of the player bases.
Note: The Target will change every time a demon is spawned.
Each Demon Spawner has up to 1 queued Demon.
Demon Spawners can only be on path tiles.

--Entity Type: Demon--

The Demon is a type of entity.
Each Demon starts the game with an amount of health determined by the current turn: The formula is: floor(current_turn / 100) * 10 + 10
Each Demon has a target Player Base.
Demons can only be on path tiles.

--Entity Type: Tower--

The Tower is a type of entity.
Each Tower has a current cooldown.
Each Tower has Allegiance to one and only one Player.
Each Tower starts the game with 20 health but is invincible (for now).
Each type of Tower has a maximum cooldown.
Each type of Tower has a price.
Each type of Tower has a range.

--Tower Type: House--

Design goal: Escalation + planning ahead

Maximum cooldown: 10
Price: 10
Range: 0

--Tower Type: Cannon--

Design goal: Powerful, but slow cooldown.

Maximum cooldown: 5
Price: 10
Range: 3

--Tower Type: Minigun--

Design goal: Powerful and hits multiple targets, but slow cooldown and expensive.

Maximum cooldown: 5
Price: 25
Range: 3

--Tower Type: Crossbow--

Design goal: Low cooldown and price, but weak

Maximum cooldown: 3
Price: 8
Range: 4

--Win/Lose Condition--

Winning/Losing is only determined when it is checked.

A player base is Destroyed if it has zero or less HP.

If one player's base is Destroyed and the other is not, the player with the surviving base wins.

If both players' bases are Destroyed, break the tie based on who has the most Gold.

Then, if both players have the same amount of Gold, break the tie based on who has built the most towers.

Then, if both players have built the same number of towers, break the tie based on the sum of prices of those towers.

Then, if both sums are equal, break the tie based on the number of Mercenaries each player has.

Then, if both have the same number of Mercenaries, break the tie based on the sum of HP of mercenaries.

Finally, break the tie with a fair coin flip. TODO: maybe not, maybe just split points
( Do this IRL with a real coin, it's more fun that way )

--Rules For Tile Layout--

The configuration of tiles needs to be fair.

The layout of tiles must have bilateral and/or biradial symmetry.
Otherwise, one player will have access to tower configurations that the other player doesn't.

Paths should not intersect.
Otherwise, it could be impossible to determine where Mercenaries should go.

Each player should start with a house.

TODO: make demon spawning behavior fair

TODO: get rid of confusion about which player you are, because that determines which direction is which

TODO: visual indicator the turn before the demon spawner spawns a demon

TODO: dynamic music